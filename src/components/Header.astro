---
const { pathname } = Astro.url;
const base = (import.meta.env.BASE_URL ?? '/').replace(/\/?$/, '/');
const withBase = (href: string) =>
  href.startsWith('/') ? `${base}${href.replace(/^\//, '')}` : href;

const navLinks = [
  { path: '/', label: 'Home' },
  { path: '/about', label: 'About' },
  { path: '/posts', label: 'All Posts' }
].map((link) => ({ ...link, href: withBase(link.path) }));

const relativePath = (() => {
  const baseTrimmed = base.replace(/\/$/, '');
  if (pathname.startsWith(baseTrimmed)) {
    const suffix = pathname.slice(baseTrimmed.length) || '/';
    return suffix.startsWith('/') ? suffix : `/${suffix}`;
  }
  return pathname || '/';
})();

const isActive = (path: string) => {
  if (path === '/') return relativePath === '/';
  const normalized = path.replace(/\/$/, '');
  const current = relativePath.replace(/\/$/, '');
  return current === normalized || current.startsWith(`${normalized}/`);
};
---

<header>
  <nav class="nav">
    <a class="nav-brand" href={withBase('/')}>Aegean Dispatch</a>
    <div class="nav-links">
      {navLinks.map((link) => (
        <a
          class={`${isActive(link.path) ? 'nav-link is-active' : 'nav-link'}`}
          href={link.href}
        >
          {link.label}
        </a>
      ))}
    </div>
  </nav>
</header>
