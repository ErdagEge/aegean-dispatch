---
import BaseLayout from './BaseLayout.astro';

const base = (import.meta.env.BASE_URL ?? '/').replace(/\/?$/, '/');
const withBase = (path: string) => (path?.startsWith('/') ? `${base}${path.slice(1)}` : path);

interface Props {
  title: string;
  description?: string;
  date: Date;
  tags: string[];
  readingTime: number;
  cover?: string;
  coverAlt?: string;
}

const { title, description, date, tags = [], cover, coverAlt, readingTime } = Astro.props as Props;
---

<BaseLayout title={`${title} - Aegean Dispatch`} description={description} pageClass="page--narrow">
  <article>
    <header style="margin-bottom: 1.4rem;">
      <p class="pill">Post</p>
      <h1 class="heading" style="font-size: clamp(2rem, 3vw, 2.6rem); margin-top: 0.4rem;">
        {title}
      </h1>
      {cover && (
        <img class="post-cover" src={withBase(cover)} alt={coverAlt ?? ''} loading="lazy" />
      )}
      <div class="post-meta">
        <span>{date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
        <span aria-hidden="true">â€¢</span>
        <span>{readingTime} min read</span>
        {tags.length > 0 && (
          <span>
            {tags.map((tag) => (
              <a class="pill pill-link" style="margin-left: 0;" href={withBase(`/tags/${tag.toLowerCase()}/`)}>{tag}</a>
            ))}
          </span>
        )}
      </div>
      {description && <p class="subheading" style="margin-top: 0.75rem;">{description}</p>}
    </header>
    <div class="post-content">
      <slot />
    </div>
  </article>
</BaseLayout>
